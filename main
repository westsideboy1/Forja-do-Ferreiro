import json
import os

# Definição do arquivo JSON 
ARQUIVO_DADOS = 'inventario_forja.json'

# Funcionalidades CRUD Obrigatórias 

def carregar():
    
    if not os.path.exists(ARQUIVO_DADOS):
        return []
    try:
        with open(ARQUIVO_DADOS, 'r', encoding='utf-8') as f:
            return json.load(f)
    except (json.JSONDecodeError, IOError):
        return []

def salvar(lista):
    
    try:
        with open(ARQUIVO_DADOS, 'w', encoding='utf-8') as f:
            json.dump(lista, f, indent=4, ensure_ascii=False)
        print("\n=== Progresso salvo na forja! ===")
    except IOError as e:
        print(f"Erro ao salvar dados: {e}")

def listar(lista):
    
    if not lista:
        print("\nO inventário da forja está vazio.")
        return

    print(f"\n{'ID':<5} | {'Nome':<20} | {'Categoria':<15} | {'Dano':<8} | {'Valor (G)':<10} | {'Estado'}")
    print("-" * 80)
    for item in lista:
        print(f"{item['id']:<5} | {item['nome']:<20} | {item['categoria']:<15} | {item['dano']:<8} | {item['valor']:<10} | {item['estado']}")

def criar(lista):
    
    print("\n--- Forjar Novo Item ---")
    
     
    while True:
        nome = input("Nome do item: ").strip()
        if nome: break
        print("O nome não pode ser vazio.")
    
    categoria = input("Categoria: ").strip() or "Desconhecido"
    
     
    try:
        dano = int(input("Dano: "))
        valor = float(input("Valor em Ouro: "))
    except ValueError:
        print("Erro: Dano e Valor devem ser números. Item descartado.")
        return

    estado = input("Estado: ").strip() or "Novo"

    
    novo_id = len(lista) + 1

    
    novo_item = {
        "id": novo_id,
        "nome": nome,
        "categoria": categoria,
        "dano": dano,
        "valor": valor,
        "estado": estado
    }

    lista.append(novo_item) 
    salvar(lista)
    print(f"Item '{nome}' forjado com sucesso! (ID: {novo_id})")

def ler_por_id(lista, id_busca):
   
    for item in lista:
        if item['id'] == id_busca:
            return item
    return None

def atualizar(lista, id_busca):
   
    item = ler_por_id(lista, id_busca)
    
    
    if not item:
        print("Erro: Item não encontrado na forja.") [cite: 32]
        return

    print(f"\nAtualizando item: {item['nome']} (Pressione Enter para manter o atual)")
    
   
    novo_nome = input(f"Novo nome [{item['nome']}]: ").strip()
    novo_cat = input(f"Nova categoria [{item['categoria']}]: ").strip()
    novo_dano = input(f"Novo dano [{item['dano']}]: ").strip()
    novo_valor = input(f"Novo valor [{item['valor']}]: ").strip()
    novo_estado = input(f"Novo estado [{item['estado']}]: ").strip()

    alteracoes_feitas = False

    
    if novo_nome: 
        item['nome'] = novo_nome
        alteracoes_feitas = True
    if novo_cat: 
        item['categoria'] = novo_cat
        alteracoes_feitas = True
    if novo_estado: 
        item['estado'] = novo_estado
        alteracoes_feitas = True
    
    
    if novo_dano:
        try:
            item['dano'] = int(novo_dano)
            alteracoes_feitas = True
        except ValueError:
            print(f"ALERTA: O dano '{novo_dano}' não é um número inteiro válido. Mantido o original.")

    if novo_valor:
        try:
            item['valor'] = float(novo_valor)
            alteracoes_feitas = True
        except ValueError:
            print(f"ALERTA: O valor '{novo_valor}' não é um número válido. Mantido o original.")

    
    if alteracoes_feitas:
        salvar(lista)
        print("Item reforjado com sucesso!")
    else:
        print("Nenhuma alteração foi realizada.")

def deletar(lista, id_busca):
    
    item = ler_por_id(lista, id_busca)
    
    if not item:
        print("Erro: Item não encontrado para destruição.") # 
        return

    print(f"Tem certeza que deseja destruir '{item['nome']}'? (S/N)")
    confirmacao = input("> ").lower()
    
    if confirmacao == 's':
        lista.remove(item)
        salvar(lista)
        print("Item destruído e removido do inventário.")
    else:
        print("Operação cancelada.")



def menu():
   
    estoque = carregar()
    
    while True:
        print("\n=== FORJA DO ARMEIRO ===")
        print("1 - Listar itens")   
        print("2 - Criar item")     
        print("3 - Consultar item")     
        print("4 - Atualizar item") 
        print("5 - Descartar item")   
        print("0 - Sair")          
        
        opcao = input("\nEscolha uma opção: ")

        
        if opcao == '1':
            listar(estoque)
        elif opcao == '2':
            criar(estoque)
        elif opcao == '3':
            try:
                id_busca = int(input("Digite o ID do item: "))
                item = ler_por_id(estoque, id_busca)
                if item:
                    print(f"\nDetalhes: {item}")
                else:
                    print("Item não encontrado.") # 
            except ValueError:
                print("Por favor, digite um número válido para o ID.") # 
        elif opcao == '4':
            try:
                id_busca = int(input("Digite o ID do item para atualizar: "))
                atualizar(estoque, id_busca)
            except ValueError:
                print("ID inválido.")
        elif opcao == '5':
            try:
                id_busca = int(input("Digite o ID do item para descarte: "))
                deletar(estoque, id_busca)
            except ValueError:
                print("ID inválido.")
        elif opcao == '0':
            print("Fechando a forja... Até logo!")
            break
        else:
            print("Opção inválida, tente novamente.")

if __name__ == "__main__":
    menu()
     
     
     
     
     
    